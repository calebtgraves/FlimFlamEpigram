<!-- host.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Game Host</title>
    <meta name="viewport" content="width=device-width">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/FlimFlamEpigram.svg') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/style.css') }}">
    <script type="text/javascript" defer>
        var socket = io();
        
        function requestGameId(){
            socket.emit('game_id_request')
        }

        requestGameId()
        socket.on('game_id', function(data) {
            document.getElementById('game-id').innerText=data.id
        });

        socket.on('instructions',function(data){
            document.getElementById('instructions').style.display = 'block'
        })

        socket.on('new_vip', function(){
            document.getElementById('player-list').removeChild(document.getElementById('player-list').firstChild)
            const newVip = Array.from(document.getElementsByClassName('player-token'))[0]
            newVip.id = "vip-player"
        })

        socket.on('last_player_disconnected', function(){
            document.getElementById('player-list').innerHTML = '';
        })

        socket.on('new_player', function(data) {
            const newPlayer = document.createElement('div');
            const playerName = document.createElement('p')
            playerName.innerText = data.name;
            playerName.style.color=data.color;
            newPlayer.appendChild(playerName)
            newPlayer.classList.add('player-token')
            if(data.vip){
                newPlayer.id = "vip-player"
            }
            newPlayer.style.backgroundColor=data.color
            document.getElementById('player-list').appendChild(newPlayer);
            var vip = data.vip
            // alert(data.id);  // For example, alerting the received message
            // You can also update the DOM based on the received data
        });

        function sleep(s) {
            ms = s * 1000
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        socket.on('instructions',function(data){
            let wait = data.wait;
            console.log(`Listening to instructions for ${wait} seconds...`);
            // TODO: Some kind of waiting logic 
            sleep(wait) // wait for a bit
        })


        let players_done
        socket.on('players_done',function(){
            players_done = true
        })

        socket.on('round',function(data){
            console.log(data.number)
            players_done = false
            let timer = 120
            console.log(timer)
            while(timer > 0 && !players_done){
                setTimeout(()=>{
                    timer -= 1
                    console.log(timer)
                },1000)
            }
            socket.emit('answers_done',{'round_num':data.number})
        })

        // dictionary[prompt][player_name] = {'answer': answer, 'votes': [player objects]} // dictionary structure for reference

        socket.on('answers',function(data){
            console.log(data);
        })

        // Additional JavaScript for managing game state...
    </script>
</head>
<body>
    <main id="host-main">
        <div id="host-main-logo"></div>
        <div id="code-container">
            <p>Game Code:</p>
            <p id="game-id"></p>
        </div>
        <div id='player-list'></div>
        <div id='instructions' style='display:none'>These are the instructions</div>
    </main>
    <!-- Additional elements for hosting the game -->
</body>
</html>